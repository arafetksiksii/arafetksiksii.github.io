<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JIGGY</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <style>
        @font-face {
    font-family: 'Minecraft';
    src: url('fonts/Minecraft.ttf') format('truetype'); /* Adjust the path if necessary */
}

        body {
            margin: 0;
            padding: 0;
            background-color: black;
            font-family: 'Minecraft', sans-serif; /* Applying Minecraft font */
        }

        .frame-container {
    position: relative;
    background: url('images/frame_pc.png') no-repeat center center;
    background-size: 100% 100%; /* Adjusted for full coverage */
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.no-affiliation img {
            display: none;
        }
        .frame-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        .header {
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 0px;
        }

        .header .logo {
            height: 40px;
            margin-bottom: 0px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            width: 93%;
            margin-top: 20px;
        }

        .navigation img {
            height: 40px;
            cursor: pointer;
        }

        .product-details {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80%;
            margin-top: 0px;
        }

        .product-details img.product-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 0px;
        }

        .product-title,
         .product-price {
            font-size: 1.2rem;
            color: white;
            margin: 10px 0;
        }

        .size-options, .color-options {
            display: flex;
            gap: 10px;
            margin-bottom: 0px;
        }

        .size-options img, .color-options img {
            width: 25px;
            height: 25px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .size-options img.selected, .color-options img.selected {
            border-color: #000000;
        }

.quantity-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    margin-top: 15px;
    padding: 8px 15px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    border: 2px solid #333;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
}

.quantity-container button {
    padding: 6px 10px;
    font-size: 1.2rem;
    cursor: pointer;
    color: white;
    background-color: #444;
    border: 2px solid #555;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.quantity-container button:hover {
    background-color: #000000;
    border-color: #000000;
}

.quantity-container button:active {
    background-color: #000000;
    border-color: #000000;
}

#quantity {
    font-size: 1.4rem;
    color: white;
    font-weight: bold;
    margin: 0 8px;
    min-width: 30px;
    text-align: center;
}


        .add-to-cart-btn img {
            width: 250px;
            cursor: pointer;
        }

        .add-to-cart-btn img.selected {
            width: 210px;
        }

        /* Loader styles */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        body.loaded .loader-container {
            display: none;
        }
        @media (max-width: 768px) { 
            .header .logo {
        margin-top: -55px; /* Moves the logo 25px upwards on small screens */
    }
    .no-affiliation img {
            display: block;

        }
    .navigation {
            display: flex;
            justify-content: space-between;
            width: 83%;
            margin-top: 20px;
        }
        }

    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container">
        <img src="images/loading.gif" alt="Loading">
    </div>

    <div class="frame-container">
        <!-- Background Video -->
        <video autoplay muted loop>
            <source src="images/glitch_background.webm" type="video/mp4">
        </video>
        
        <div class="header">
            <img class="logo" src="images/jiggy_text_white.png" alt="JIGGY Logo">
            <div class="navigation">
                <img class="back-arrow" src="images/icon_arrow_left.png" alt="Back" onclick="location.href='/shop'">
                <img class="cart" src="images/cart_empty.png" alt="Cart" onclick="location.href='/cart'">
            </div>
        </div>

        <!-- Product Details -->
        <div class="product-details">
            <!-- Product Image -->
            <img id="product-image" class="product-image" src="images/product1.png" alt="Product">

            <!-- Product Title and Price -->
            <div id="product-title" class="product-title">Product Title</div>
            <div id="product-price" class="product-price">$29.99</div>

            <!-- Size Options -->
<!-- Size Options -->
<div id="size-options" class="size-options">
    <img id="size-xs" class="size-option" src="images/XS1.png" alt="XS" data-available="true" onclick="changeSize('XS')">
    <img id="size-s" class="size-option" src="images/S1.png" alt="S" data-available="true" onclick="changeSize('S')">
    <img id="size-m" class="size-option" src="images/M1.png" alt="M" data-available="true" onclick="changeSize('M')">
    <img id="size-l" class="size-option" src="images/L1.png" alt="L" data-available="true" onclick="changeSize('L')">
    <img id="size-xl" class="size-option" src="images/XL1.png" alt="XL" data-available="true" onclick="changeSize('XL')">
    <img id="size-2xl" class="size-option" src="images/2XL1.png" alt="2XL" data-available="true" onclick="changeSize('2XL')">
</div>


            <!-- Color Options -->
            <div id="color-options" class="color-options">
                <img id="color-grey" src="images/grey1.png" alt="Grey" onclick="changeColor('grey')">
                <img id="color-black" src="images/black1.png" alt="Black" onclick="changeColor('black')">
                <img id="color-pink" src="images/pink1.png" alt="Pink" onclick="changeColor('pink')">
                <img id="color-lightpink" src="images/lightpink1.png" alt="Light Pink" onclick="changeColor('lightpink')">
            </div>

            <!-- Quantity Selector -->
            <div class="quantity-container">
                <button onclick="updateQuantity('decrease')">-</button>
                <div id="quantity">1</div>
                <button onclick="updateQuantity('increase')">+</button>
            </div>

            <!-- Add to Cart Button -->
            <div class="add-to-cart-btn">
                <img id="add-to-cart-btn" src="images/add-to-cart-btn1.png" alt="Add to Cart" onclick="changeCartButton()">
            </div>
        </div>
                <!-- Additional images for small screens -->
                <div class="no-affiliation" style="text-align: center; margin-top: 20px;">
                    <img src="images/NO AFFILIATION.png" alt="No Affiliation">
                </div>
    </div>
    <script>
let selectedSize = null;
let selectedColor = null;
let selectedQuantity = 1;
let haveSizes2 = null ;

   // Get product ID from the URL
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('_id');

// Fetch product details using the product ID
fetch(`http://localhost:3000/products/${productId}`)
    .then(response => response.json())
    .then(productData => {
        // Update product details
        document.querySelector('.product-title').textContent = productData.title;
        document.querySelector('.product-price').textContent = productData.price + ' TND';
        document.getElementById('product-image').src = productData.image;

        // Update size availability
        updateSizeAvailability(productData);
        selectedColor = productData.color
        haveSizes2 = productData.haveSizes

        // Fetch all products with the same name using POST request
        fetch('http://localhost:3000/products/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ title: productData.title }),
        })
            .then(response => response.json())
            .then(colorVariants => {
                // Update color options
                updateColorOptions(colorVariants, productData.color);
            })
            .catch(error => {
                console.error('Error fetching related products:', error);
            });
    })
    .catch(error => {
        console.error('Error fetching product details:', error);
    });      
    

// Change size
function changeSize(size) {
    // Reset all size images to 1
    document.querySelectorAll('.size-options img').forEach(img => {
        img.src = img.src.replace('2.png', '1.png');
    });

    // Change the selected size to 2
    document.getElementById(`size-${size.toLowerCase()}`).src = document.getElementById(`size-${size.toLowerCase()}`).src.replace('1.png', '2.png');
    selectedSize = size;

}

// Change color
function changeColor(selectedVariant, colorVariants) {
    // Update main image
    document.getElementById('product-image').src = selectedVariant.image;

    // Update selected color
    colorVariants.forEach(variant => {
        const colorElement = document.getElementById(`color-${variant.color}`);
        const isSelected = variant.color === selectedVariant.color;

        colorElement.src = `images/${variant.color}${isSelected ? '2' : '1'}.png`;
        colorElement.classList.toggle('selected', isSelected);
    });


    // Update size availability based on the selected color
    updateSizeAvailability(selectedVariant);

}

// Update quantity
function updateQuantity(action) {
    if (action === 'increase') {
        selectedQuantity++;
    } else if (action === 'decrease' && selectedQuantity > 1) {
        selectedQuantity--;
    }

    document.getElementById('quantity').textContent = selectedQuantity;
}

// Add to Cart
function changeCartButton() {
   // Check if a size is selected
   let selectedSize = ""; // Default value

function addToCart(haveSizes) {
    // Check if sizes are required and selected
    if (haveSizes2 && !selectedSize) {
        alert("Please select a size!");
        return; // Stop further execution
    }

    // If sizes are not required, pass a blank space
    if (!haveSizes2) {
        selectedSize = " ";
    }

    // Proceed to add to cart
    console.log(`Adding to cart with size: "${selectedSize}"`);
    // Add your cart logic here
}

    
    // Collect product details
    const productDetails = {
        image: document.getElementById('product-image').src,
        title: document.getElementById('product-title').textContent,
        price: parseFloat(document.getElementById('product-price').textContent.replace('TND', '').trim()),
        size: selectedSize,
        color: selectedColor,
        quantity: selectedQuantity
    };

    // Store in local storage (or cart object)
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const cartImage = document.querySelector('.cart');
    cartImage.src = 'images/cart.png'; // Set the image to cart.png

    cart.push(productDetails);
    localStorage.setItem('cart', JSON.stringify(cart));

    // You can add any further actions like changing button text, etc.
    const cartButton = document.getElementById('add-to-cart-btn');
    cartButton.src = 'images/add-to-cart-btn2.png';
}

      

// Function to update size availability
function updateSizeAvailability(selectedVariant) {
    selectedColor = selectedVariant.color

    const sizeOptions = ['XS', 'S', 'M', 'L', 'XL', '2XL'];

    sizeOptions.forEach(size => {
        const sizeElement = document.getElementById(`size-${size.toLowerCase()}`);
        const isAvailable = selectedVariant[`is${size}Available`];

        // Check availability and update the image and button state
        if (!isAvailable) {
            sizeElement.src = sizeElement.src.replace('1.png', '3.png');  // Use the out-of-stock image
            sizeElement.style.pointerEvents = 'none';  // Disable clicking
        } else {
            sizeElement.style.pointerEvents = 'auto';  // Enable clicking
            sizeElement.src = sizeElement.src.replace('3.png', '1.png');  // Use the in-stock image
        }
    });
}
        
       // Change size (updates the selected size image)

// Change color and update product image (updates the selected color image)
function updateColorOptions(colorVariants, currentColor) {
    const colorContainer = document.querySelector('.color-options');
    colorContainer.innerHTML = ''; // Clear existing colors

    colorVariants.forEach(variant => {
        const color = variant.color;
        const colorImg = document.createElement('img');
        const isSelected = color === currentColor;

        colorImg.id = `color-${color}`;
        colorImg.src = `images/${color}${isSelected ? '2' : '1'}.png`;
        colorImg.alt = color.charAt(0).toUpperCase() + color.slice(1);
        colorImg.classList.add('color-option');
        if (isSelected) colorImg.classList.add('selected');

        colorImg.onclick = () => changeColor(variant, colorVariants);

        colorContainer.appendChild(colorImg);
    });
}

// Function to change color
function changeColor(selectedVariant, colorVariants) {
    // Update main image
    document.getElementById('product-image').src = selectedVariant.image;

    // Update selected color
    colorVariants.forEach(variant => {
        const colorElement = document.getElementById(`color-${variant.color}`);
        const isSelected = variant.color === selectedVariant.color;

        colorElement.src = `images/${variant.color}${isSelected ? '2' : '1'}.png`;
        colorElement.classList.toggle('selected', isSelected);
    });

    // Update size availability based on the selected color
    updateSizeAvailability(selectedVariant);  // Make sure this is using the selected color's availability data
}







        // Remove the loader after the page is fully loaded
        window.addEventListener('load', function () {
            document.body.classList.add('loaded');
        });
    </script>
    <script>
        // Check if cart exists in localStorage and is not empty
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Select the cart image element
        const cartImage = document.querySelector('.cart');
        
        // Change the cart image if there are items in the cart
        if (cart.length > 0) {
            cartImage.src = 'images/cart.png'; // Set the image to cart.png
        } else {
            cartImage.src = 'images/cart_empty.png'; // Set the image to cart_empty.png
        }
        </script>
        <script>
            // Function to toggle size options based on `haveSizes` value
            function updateSizeVisibility(haveSizes) {
                const sizeOptions = document.getElementById('size-options');
                if (!haveSizes) {
                    sizeOptions.style.display = 'none';
                } else {
                    sizeOptions.style.display = 'flex'; // Ensure it remains visible if `haveSizes` is true
                }
            }
        
            // Assuming the `productData` object has been fetched already
            fetch(`http://localhost:3000/products/${productId}`)
                .then(response => response.json())
                .then(productData => {
                    // Call the function to update size visibility
                    updateSizeVisibility(productData.haveSizes);
                })
                .catch(error => {
                    console.error('Error fetching product details:', error);
                });
        </script>
        
        
</body>
</html>
